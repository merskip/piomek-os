.SUFFIXES: .asm .c .cpp

SUBDIR := drives kernel

CC=gcc
CXX=g++
ASM=nasm

CFLAGS=
CXXLAGS=
LFLAGS=-T linker.ld
ASMFLAGS=-f elf

OBJS=\
	start.o 			\
	main.o 				\
	drives/video.o 			\
	kernel/io.o 			\
	kernel/intr.o			\
	drives/keyboard.o		\
	kernel/common.o			\
	kernel/string.o			\
	kernel/kernel.o 		\
	kernel/commands.o

OBJS_LOC=\
	start.o 			\
	main.o 			\
	drives/video.o 		\
	kernel/io.o 		\
	kernel/intr.o		\
	drives/keyboard.o	\
	kernel/common.o		\
	kernel/string.o		\
	kernel/kernel.o 		\
	kernel/commands.o	

Lascaux.iso: kernel.bin
	cp kernel.bin iso/boot/kernel.bin
	grub-mkrescue -o Lascaux.iso iso

kernel.bin: $(OBJS)
	@echo " ----- "
	@echo "ld $(LFLAGS) -o $@ (...)"
	@ld $(LFLAGS) -o $@ $(OBJS_LOC)

.asm.o:
	$(ASM) $(ASMFLAGS) -o $@ $<

.c.o:
	$(CC) $(CFLAGS) -o $@ -c $<

.cpp.o:
	$(CXX) $(CXXLAGS) -o $@ -c $<



clean:
	rm -f *.o
